!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.GoogleMapsService=t():e.GoogleMapsService=t()}(self,()=>(()=>{"use strict";var e,t,r={d:(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},n={};function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}r.d(n,{default:()=>ye}),"function"==typeof SuppressedError&&SuppressedError;var s=(t||(t=1,e=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var n,i,s;if(Array.isArray(t)){if((n=t.length)!=r.length)return!1;for(i=n;0!==i--;)if(!e(t[i],r[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((n=(s=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(i=n;0!==i--;)if(!Object.prototype.hasOwnProperty.call(r,s[i]))return!1;for(i=n;0!==i--;){var o=s[i];if(!e(t[o],r[o]))return!1}return!0}return t!=t&&r!=r}),e),o=i(s);const a="__googleMapsScriptId";var l;!function(e){e[e.INITIALIZED=0]="INITIALIZED",e[e.LOADING=1]="LOADING",e[e.SUCCESS=2]="SUCCESS",e[e.FAILURE=3]="FAILURE"}(l||(l={}));class c{constructor({apiKey:e,authReferrerPolicy:t,channel:r,client:n,id:i=a,language:s,libraries:l=[],mapIds:u,nonce:h,region:p,retries:d=3,url:g="https://maps.googleapis.com/maps/api/js",version:m}){if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=e,this.authReferrerPolicy=t,this.channel=r,this.client=n,this.id=i||a,this.language=s,this.libraries=l,this.mapIds=u,this.nonce=h,this.region=p,this.retries=d,this.url=g,this.version=m,c.instance){if(!o(this.options,c.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(c.instance.options)}`);return c.instance}c.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?l.FAILURE:this.done?l.SUCCESS:this.loading?l.LOADING:l.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let e=this.url;return e+="?callback=__googleMapsCallback&loading=async",this.apiKey&&(e+=`&key=${this.apiKey}`),this.channel&&(e+=`&channel=${this.channel}`),this.client&&(e+=`&client=${this.client}`),this.libraries.length>0&&(e+=`&libraries=${this.libraries.join(",")}`),this.language&&(e+=`&language=${this.language}`),this.region&&(e+=`&region=${this.region}`),this.version&&(e+=`&v=${this.version}`),this.mapIds&&(e+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(e+=`&auth_referrer_policy=${this.authReferrerPolicy}`),e}deleteScript(){const e=document.getElementById(this.id);e&&e.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((e,t)=>{this.loadCallback(r=>{r?t(r.error):e(window.google)})})}importLibrary(e){return this.execute(),google.maps.importLibrary(e)}loadCallback(e){this.callbacks.push(e),this.execute()}setScript(){var e,t;if(document.getElementById(this.id))return void this.callback();const r={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(r).forEach(e=>!r[e]&&delete r[e]),(null===(t=null===(e=null===window||void 0===window?void 0:window.google)||void 0===e?void 0:e.maps)||void 0===t?void 0:t.importLibrary)||(e=>{let t,r,n,i="The Google Maps JavaScript API",s="google",o="importLibrary",a="__ib__",l=document,c=window;c=c[s]||(c[s]={});const u=c.maps||(c.maps={}),h=new Set,p=new URLSearchParams,d=()=>t||(t=new Promise((o,c)=>{return d=this,g=void 0,f=function*(){var d;for(n in yield r=l.createElement("script"),r.id=this.id,p.set("libraries",[...h]+""),e)p.set(n.replace(/[A-Z]/g,e=>"_"+e[0].toLowerCase()),e[n]);p.set("callback",s+".maps."+a),r.src=this.url+"?"+p,u[a]=o,r.onerror=()=>t=c(Error(i+" could not load.")),r.nonce=this.nonce||(null===(d=l.querySelector("script[nonce]"))||void 0===d?void 0:d.nonce)||"",l.head.append(r)},new((m=void 0)||(m=Promise))(function(e,t){function r(e){try{i(f.next(e))}catch(e){t(e)}}function n(e){try{i(f.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):(i=t.value,i instanceof m?i:new m(function(e){e(i)})).then(r,n)}i((f=f.apply(d,g||[])).next())});var d,g,m,f}));u[o]?console.warn(i+" only loads once. Ignoring:",e):u[o]=(e,...t)=>h.add(e)&&d().then(()=>u[o](e,...t))})(r);const n=this.libraries.map(e=>this.importLibrary(e));n.length||n.push(this.importLibrary("core")),Promise.all(n).then(()=>this.callback(),e=>{const t=new ErrorEvent("error",{error:e});this.loadErrorCallback(t)})}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(e){if(this.errors.push(e),this.errors.length<=this.retries){const e=this.errors.length*Math.pow(2,this.errors.length);console.error(`Failed to load Google Maps script, retrying in ${e} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},e)}else this.onerrorEvent=e,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(e=>{e(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),!this.loading)if(this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version)return console.warn("Google Maps already loaded outside @googlemaps/js-api-loader. This may result in undesirable behavior as options and script parameters may not match."),void this.callback();this.loading=!0,this.setScript()}}}var u=Object.getOwnPropertyNames,h=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty;function d(e,t){return function(r,n,i){return e(r,n,i)&&t(r,n,i)}}function g(e){return function(t,r,n){if(!t||!r||"object"!=typeof t||"object"!=typeof r)return e(t,r,n);var i=n.cache,s=i.get(t),o=i.get(r);if(s&&o)return s===r&&o===t;i.set(t,r),i.set(r,t);var a=e(t,r,n);return i.delete(t),i.delete(r),a}}function m(e){return u(e).concat(h(e))}var f=Object.hasOwn||function(e,t){return p.call(e,t)};function v(e,t){return e===t||!e&&!t&&e!=e&&t!=t}var y=Object.getOwnPropertyDescriptor,k=Object.keys;function b(e,t,r){var n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(!r.equals(e[n],t[n],n,n,e,t,r))return!1;return!0}function M(e,t){return v(e.getTime(),t.getTime())}function w(e,t){return e.name===t.name&&e.message===t.message&&e.cause===t.cause&&e.stack===t.stack}function E(e,t){return e===t}function C(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var i,s,o=new Array(n),a=e.entries(),l=0;(i=a.next())&&!i.done;){for(var c=t.entries(),u=!1,h=0;(s=c.next())&&!s.done;)if(o[h])h++;else{var p=i.value,d=s.value;if(r.equals(p[0],d[0],l,h,e,t,r)&&r.equals(p[1],d[1],p[0],d[0],e,t,r)){u=o[h]=!0;break}h++}if(!u)return!1;l++}return!0}var A=v;function I(e,t,r){var n=k(e),i=n.length;if(k(t).length!==i)return!1;for(;i-- >0;)if(!j(e,t,r,n[i]))return!1;return!0}function x(e,t,r){var n,i,s,o=m(e),a=o.length;if(m(t).length!==a)return!1;for(;a-- >0;){if(!j(e,t,r,n=o[a]))return!1;if(i=y(e,n),s=y(t,n),(i||s)&&(!i||!s||i.configurable!==s.configurable||i.enumerable!==s.enumerable||i.writable!==s.writable))return!1}return!0}function _(e,t){return v(e.valueOf(),t.valueOf())}function O(e,t){return e.source===t.source&&e.flags===t.flags}function L(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var i,s,o=new Array(n),a=e.values();(i=a.next())&&!i.done;){for(var l=t.values(),c=!1,u=0;(s=l.next())&&!s.done;){if(!o[u]&&r.equals(i.value,s.value,i.value,s.value,e,t,r)){c=o[u]=!0;break}u++}if(!c)return!1}return!0}function P(e,t){var r=e.length;if(t.length!==r)return!1;for(;r-- >0;)if(e[r]!==t[r])return!1;return!0}function S(e,t){return e.hostname===t.hostname&&e.pathname===t.pathname&&e.protocol===t.protocol&&e.port===t.port&&e.hash===t.hash&&e.username===t.username&&e.password===t.password}function j(e,t,r,n){return!("_owner"!==n&&"__o"!==n&&"__v"!==n||!e.$$typeof&&!t.$$typeof)||f(t,n)&&r.equals(e[n],t[n],n,n,e,t,r)}var T=Array.isArray,q="function"==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView:null,R=Object.assign,U=Object.prototype.toString.call.bind(Object.prototype.toString);var Z=F();function F(e){void 0===e&&(e={});var t,r=e.circular,n=void 0!==r&&r,i=e.createInternalComparator,s=e.createState,o=e.strict,a=void 0!==o&&o,l=function(e){var t=e.circular,r=e.createCustomConfig,n=e.strict,i={areArraysEqual:n?x:b,areDatesEqual:M,areErrorsEqual:w,areFunctionsEqual:E,areMapsEqual:n?d(C,x):C,areNumbersEqual:A,areObjectsEqual:n?x:I,arePrimitiveWrappersEqual:_,areRegExpsEqual:O,areSetsEqual:n?d(L,x):L,areTypedArraysEqual:n?x:P,areUrlsEqual:S,unknownTagComparators:void 0};if(r&&(i=R({},i,r(i))),t){var s=g(i.areArraysEqual),o=g(i.areMapsEqual),a=g(i.areObjectsEqual),l=g(i.areSetsEqual);i=R({},i,{areArraysEqual:s,areMapsEqual:o,areObjectsEqual:a,areSetsEqual:l})}return i}(e),c=function(e){var t=e.areArraysEqual,r=e.areDatesEqual,n=e.areErrorsEqual,i=e.areFunctionsEqual,s=e.areMapsEqual,o=e.areNumbersEqual,a=e.areObjectsEqual,l=e.arePrimitiveWrappersEqual,c=e.areRegExpsEqual,u=e.areSetsEqual,h=e.areTypedArraysEqual,p=e.areUrlsEqual,d=e.unknownTagComparators;return function(e,g,m){if(e===g)return!0;if(null==e||null==g)return!1;var f=typeof e;if(f!==typeof g)return!1;if("object"!==f)return"number"===f?o(e,g,m):"function"===f&&i(e,g,m);var v=e.constructor;if(v!==g.constructor)return!1;if(v===Object)return a(e,g,m);if(T(e))return t(e,g,m);if(null!=q&&q(e))return h(e,g,m);if(v===Date)return r(e,g,m);if(v===RegExp)return c(e,g,m);if(v===Map)return s(e,g,m);if(v===Set)return u(e,g,m);var y,k=U(e);if("[object Date]"===k)return r(e,g,m);if("[object RegExp]"===k)return c(e,g,m);if("[object Map]"===k)return s(e,g,m);if("[object Set]"===k)return u(e,g,m);if("[object Object]"===k)return"function"!=typeof e.then&&"function"!=typeof g.then&&a(e,g,m);if("[object URL]"===k)return p(e,g,m);if("[object Error]"===k)return n(e,g,m);if("[object Arguments]"===k)return a(e,g,m);if("[object Boolean]"===k||"[object Number]"===k||"[object String]"===k)return l(e,g,m);if(d){var b=d[k];if(!b){var M=null!=(y=e)?y[Symbol.toStringTag]:void 0;M&&(b=d[M])}if(b)return b(e,g,m)}return!1}}(l);return function(e){var t=e.circular,r=e.comparator,n=e.createState,i=e.equals,s=e.strict;if(n)return function(e,o){var a=n(),l=a.cache,c=void 0===l?t?new WeakMap:void 0:l,u=a.meta;return r(e,o,{cache:c,equals:i,meta:u,strict:s})};if(t)return function(e,t){return r(e,t,{cache:new WeakMap,equals:i,meta:void 0,strict:s})};var o={cache:void 0,equals:i,meta:void 0,strict:s};return function(e,t){return r(e,t,o)}}({circular:n,comparator:c,createState:s,equals:i?i(c):(t=c,function(e,r,n,i,s,o,a){return t(e,r,a)}),strict:a})}F({strict:!0}),F({circular:!0}),F({circular:!0,strict:!0}),F({createInternalComparator:function(){return v}}),F({strict:!0,createInternalComparator:function(){return v}}),F({circular:!0,createInternalComparator:function(){return v}}),F({circular:!0,createInternalComparator:function(){return v},strict:!0});const D=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class N{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,r]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const n=r>>4;if(1!==n)throw new Error(`Got v${n} data when expected v1.`);const i=D[15&r];if(!i)throw new Error("Unrecognized array type.");const[s]=new Uint16Array(e,2,1),[o]=new Uint32Array(e,4,1);return new N(o,s,i,e)}constructor(e,t=64,r=Float64Array,n){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const i=D.indexOf(this.ArrayType),s=2*e*this.ArrayType.BYTES_PER_ELEMENT,o=e*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-o%8)%8;if(i<0)throw new Error(`Unexpected typed array class: ${r}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+o+a,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+s+o+a),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+o+a,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+i]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=t,r}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return $(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,r,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:s,nodeSize:o}=this,a=[0,i.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=o){for(let o=h;o<=u;o++){const a=s[2*o],c=s[2*o+1];a>=e&&a<=r&&c>=t&&c<=n&&l.push(i[o])}continue}const p=h+u>>1,d=s[2*p],g=s[2*p+1];d>=e&&d<=r&&g>=t&&g<=n&&l.push(i[p]),(0===c?e<=d:t<=g)&&(a.push(h),a.push(p-1),a.push(1-c)),(0===c?r>=d:n>=g)&&(a.push(p+1),a.push(u),a.push(1-c))}return l}within(e,t,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:i,nodeSize:s}=this,o=[0,n.length-1,0],a=[],l=r*r;for(;o.length;){const c=o.pop()||0,u=o.pop()||0,h=o.pop()||0;if(u-h<=s){for(let r=h;r<=u;r++)K(i[2*r],i[2*r+1],e,t)<=l&&a.push(n[r]);continue}const p=h+u>>1,d=i[2*p],g=i[2*p+1];K(d,g,e,t)<=l&&a.push(n[p]),(0===c?e-r<=d:t-r<=g)&&(o.push(h),o.push(p-1),o.push(1-c)),(0===c?e+r>=d:t+r>=g)&&(o.push(p+1),o.push(u),o.push(1-c))}return a}}function $(e,t,r,n,i,s){if(i-n<=r)return;const o=n+i>>1;z(e,t,o,n,i,s),$(e,t,r,n,o-1,1-s),$(e,t,r,o+1,i,1-s)}function z(e,t,r,n,i,s){for(;i>n;){if(i-n>600){const o=i-n+1,a=r-n+1,l=Math.log(o),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(o-c)/o)*(a-o/2<0?-1:1);z(e,t,r,Math.max(n,Math.floor(r-a*c/o+u)),Math.min(i,Math.floor(r+(o-a)*c/o+u)),s)}const o=t[2*r+s];let a=n,l=i;for(B(e,t,n,r),t[2*i+s]>o&&B(e,t,n,i);a<l;){for(B(e,t,a,l),a++,l--;t[2*a+s]<o;)a++;for(;t[2*l+s]>o;)l--}t[2*n+s]===o?B(e,t,n,l):(l++,B(e,t,l,i)),l<=r&&(n=l+1),r<=l&&(i=l-1)}}function B(e,t,r,n){G(e,r,n),G(t,2*r,2*n),G(t,2*r+1,2*n+1)}function G(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function K(e,t,r,n){const i=e-r,s=t-n;return i*i+s*s}const V={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},W=Math.fround||(J=new Float32Array(1),e=>(J[0]=+e,J[0]));var J;class X{constructor(e){this.options=Object.assign(Object.create(V),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:r,maxZoom:n}=this.options;t&&console.time("total time");const i=`prepare ${e.length} points`;t&&console.time(i),this.points=e;const s=[];for(let t=0;t<e.length;t++){const r=e[t];if(!r.geometry)continue;const[n,i]=r.geometry.coordinates,o=W(Q(n)),a=W(ee(i));s.push(o,a,1/0,t,-1,1),this.options.reduce&&s.push(0)}let o=this.trees[n+1]=this._createTree(s);t&&console.timeEnd(i);for(let e=n;e>=r;e--){const r=+Date.now();o=this.trees[e]=this._createTree(this._cluster(o,e)),t&&console.log("z%d: %d clusters in %dms",e,o.numItems,+Date.now()-r)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let r=((e[0]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,e[1]));let i=180===e[2]?180:((e[2]+180)%360+360)%360-180;const s=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)r=-180,i=180;else if(r>i){const e=this.getClusters([r,n,180,s],t),o=this.getClusters([-180,n,i,s],t);return e.concat(o)}const o=this.trees[this._limitZoom(t)],a=o.range(Q(r),ee(s),Q(i),ee(n)),l=o.data,c=[];for(const e of a){const t=this.stride*e;c.push(l[t+5]>1?Y(l,t,this.clusterProps):this.points[l[t+3]])}return c}getChildren(e){const t=this._getOriginId(e),r=this._getOriginZoom(e),n="No cluster with the specified id.",i=this.trees[r];if(!i)throw new Error(n);const s=i.data;if(t*this.stride>=s.length)throw new Error(n);const o=this.options.radius/(this.options.extent*Math.pow(2,r-1)),a=s[t*this.stride],l=s[t*this.stride+1],c=i.within(a,l,o),u=[];for(const t of c){const r=t*this.stride;s[r+4]===e&&u.push(s[r+5]>1?Y(s,r,this.clusterProps):this.points[s[r+3]])}if(0===u.length)throw new Error(n);return u}getLeaves(e,t,r){t=t||10,r=r||0;const n=[];return this._appendLeaves(n,e,t,r,0),n}getTile(e,t,r){const n=this.trees[this._limitZoom(e)],i=Math.pow(2,e),{extent:s,radius:o}=this.options,a=o/s,l=(r-a)/i,c=(r+1+a)/i,u={features:[]};return this._addTileFeatures(n.range((t-a)/i,l,(t+1+a)/i,c),n.data,t,r,i,u),0===t&&this._addTileFeatures(n.range(1-a/i,l,1,c),n.data,i,r,i,u),t===i-1&&this._addTileFeatures(n.range(0,l,a/i,c),n.data,-1,r,i,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const r=this.getChildren(e);if(t++,1!==r.length)break;e=r[0].properties.cluster_id}return t}_appendLeaves(e,t,r,n,i){const s=this.getChildren(t);for(const t of s){const s=t.properties;if(s&&s.cluster?i+s.point_count<=n?i+=s.point_count:i=this._appendLeaves(e,s.cluster_id,r,n,i):i<n?i++:e.push(t),e.length===r)break}return i}_createTree(e){const t=new N(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let r=0;r<e.length;r+=this.stride)t.add(e[r],e[r+1]);return t.finish(),t.data=e,t}_addTileFeatures(e,t,r,n,i,s){for(const o of e){const e=o*this.stride,a=t[e+5]>1;let l,c,u;if(a)l=H(t,e,this.clusterProps),c=t[e],u=t[e+1];else{const r=this.points[t[e+3]];l=r.properties;const[n,i]=r.geometry.coordinates;c=Q(n),u=ee(i)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*i-r)),Math.round(this.options.extent*(u*i-n))]],tags:l};let p;p=a||this.options.generateId?t[e+3]:this.points[t[e+3]].id,void 0!==p&&(h.id=p),s.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:r,extent:n,reduce:i,minPoints:s}=this.options,o=r/(n*Math.pow(2,t)),a=e.data,l=[],c=this.stride;for(let r=0;r<a.length;r+=c){if(a[r+2]<=t)continue;a[r+2]=t;const n=a[r],u=a[r+1],h=e.within(a[r],a[r+1],o),p=a[r+5];let d=p;for(const e of h){const r=e*c;a[r+2]>t&&(d+=a[r+5])}if(d>p&&d>=s){let e,s=n*p,o=u*p,g=-1;const m=(r/c<<5)+(t+1)+this.points.length;for(const n of h){const l=n*c;if(a[l+2]<=t)continue;a[l+2]=t;const u=a[l+5];s+=a[l]*u,o+=a[l+1]*u,a[l+4]=m,i&&(e||(e=this._map(a,r,!0),g=this.clusterProps.length,this.clusterProps.push(e)),i(e,this._map(a,l)))}a[r+4]=m,l.push(s/d,o/d,1/0,m,-1,d),i&&l.push(g)}else{for(let e=0;e<c;e++)l.push(a[r+e]);if(d>1)for(const e of h){const r=e*c;if(!(a[r+2]<=t)){a[r+2]=t;for(let e=0;e<c;e++)l.push(a[r+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,r){if(e[t+5]>1){const n=this.clusterProps[e[t+6]];return r?Object.assign({},n):n}const n=this.points[e[t+3]].properties,i=this.options.map(n);return r&&i===n?Object.assign({},i):i}}function Y(e,t,r){return{type:"Feature",id:e[t+3],properties:H(e,t,r),geometry:{type:"Point",coordinates:[(n=e[t],360*(n-.5)),te(e[t+1])]}};var n}function H(e,t,r){const n=e[t+5],i=n>=1e4?`${Math.round(n/1e3)}k`:n>=1e3?Math.round(n/100)/10+"k":n,s=e[t+6],o=-1===s?{}:Object.assign({},r[s]);return Object.assign(o,{cluster:!0,cluster_id:e[t+3],point_count:n,point_count_abbreviated:i})}function Q(e){return e/360+.5}function ee(e){const t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function te(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}"function"==typeof SuppressedError&&SuppressedError;class re{static isAdvancedMarkerAvailable(e){return google.maps.marker&&!0===e.getMapCapabilities().isAdvancedMarkersAvailable}static isAdvancedMarker(e){return google.maps.marker&&e instanceof google.maps.marker.AdvancedMarkerElement}static setMap(e,t){this.isAdvancedMarker(e)?e.map=t:e.setMap(t)}static getPosition(e){if(this.isAdvancedMarker(e)){if(e.position){if(e.position instanceof google.maps.LatLng)return e.position;if(Number.isFinite(e.position.lat)&&Number.isFinite(e.position.lng))return new google.maps.LatLng(e.position.lat,e.position.lng)}return new google.maps.LatLng(null)}return e.getPosition()}static getVisible(e){return!!this.isAdvancedMarker(e)||e.getVisible()}}class ne{constructor({markers:e,position:t}){this.markers=[],e&&(this.markers=e),t&&(t instanceof google.maps.LatLng?this._position=t:this._position=new google.maps.LatLng(t))}get bounds(){if(0===this.markers.length&&!this._position)return;const e=new google.maps.LatLngBounds(this._position,this._position);for(const t of this.markers)e.extend(re.getPosition(t));return e}get position(){return this._position||this.bounds.getCenter()}get count(){return this.markers.filter(e=>re.getVisible(e)).length}push(e){this.markers.push(e)}delete(){this.marker&&(re.setMap(this.marker,null),this.marker=void 0),this.markers.length=0}}function ie(e,t="assertion failed"){if(null==e)throw Error(t)}class se{constructor({maxZoom:e=16}){this.maxZoom=e}noop({markers:e}){return oe(e)}}const oe=e=>e.map(e=>new ne({position:re.getPosition(e),markers:[e]}));class ae extends se{constructor(e){var{maxZoom:t,radius:r=60}=e,n=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["maxZoom","radius"]);super({maxZoom:t}),this.markers=[],this.clusters=[],this.state={zoom:-1},this.superCluster=new X(Object.assign({maxZoom:this.maxZoom,radius:r},n))}calculate(e){let t=!1,r=e.map.getZoom();ie(r),r=Math.round(r);const n={zoom:r};if(!Z(e.markers,this.markers)){t=!0,this.markers=[...e.markers];const r=this.markers.map(e=>{const t=re.getPosition(e);return{type:"Feature",geometry:{type:"Point",coordinates:[t.lng(),t.lat()]},properties:{marker:e}}});this.superCluster.load(r)}return t||(this.state.zoom<=this.maxZoom||n.zoom<=this.maxZoom)&&(t=!Z(this.state,n)),this.state=n,0===e.markers.length?(this.clusters=[],{clusters:this.clusters,changed:t}):(t&&(this.clusters=this.cluster(e)),{clusters:this.clusters,changed:t})}cluster({map:e}){const t=e.getZoom();return ie(t),this.superCluster.getClusters([-180,-90,180,90],Math.round(t)).map(e=>this.transformCluster(e))}transformCluster({geometry:{coordinates:[e,t]},properties:r}){if(r.cluster)return new ne({markers:this.superCluster.getLeaves(r.cluster_id,1/0).map(e=>e.properties.marker),position:{lat:t,lng:e}});const n=r.marker;return new ne({markers:[n],position:re.getPosition(n)})}}class le{constructor(e,t){this.markers={sum:e.length};const r=t.map(e=>e.count),n=r.reduce((e,t)=>e+t,0);this.clusters={count:t.length,markers:{mean:n/t.length,sum:n,min:Math.min(...r),max:Math.max(...r)}}}}class ce{render({count:e,position:t},r,n){const i=`<svg fill="${e>Math.max(10,r.clusters.markers.mean)?"#ff0000":"#0000ff"}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 240" width="50" height="50">\n<circle cx="120" cy="120" opacity=".6" r="70" />\n<circle cx="120" cy="120" opacity=".3" r="90" />\n<circle cx="120" cy="120" opacity=".2" r="110" />\n<text x="50%" y="50%" style="fill:#fff" text-anchor="middle" font-size="50" dominant-baseline="middle" font-family="roboto,arial,sans-serif">${e}</text>\n</svg>`,s=`Cluster of ${e} markers`,o=Number(google.maps.Marker.MAX_ZINDEX)+e;if(re.isAdvancedMarkerAvailable(n)){const e=(new DOMParser).parseFromString(i,"image/svg+xml").documentElement;e.setAttribute("transform","translate(0 25)");const r={map:n,position:t,zIndex:o,title:s,content:e};return new google.maps.marker.AdvancedMarkerElement(r)}const a={position:t,zIndex:o,title:s,icon:{url:`data:image/svg+xml;base64,${btoa(i)}`,anchor:new google.maps.Point(25,25)}};return new google.maps.Marker(a)}}class ue{constructor(){!function(e,t){for(let r in t.prototype)e.prototype[r]=t.prototype[r]}(ue,google.maps.OverlayView)}}var he;!function(e){e.CLUSTERING_BEGIN="clusteringbegin",e.CLUSTERING_END="clusteringend",e.CLUSTER_CLICK="click",e.GMP_CLICK="gmp-click"}(he||(he={}));const pe=(e,t,r)=>{t.bounds&&r.fitBounds(t.bounds)};class de extends ue{constructor({map:e,markers:t=[],algorithmOptions:r={},algorithm:n=new ae(r),renderer:i=new ce,onClusterClick:s=pe}){super(),this.map=null,this.idleListener=null,this.markers=[...t],this.clusters=[],this.algorithm=n,this.renderer=i,this.onClusterClick=s,e&&this.setMap(e)}addMarker(e,t){this.markers.includes(e)||(this.markers.push(e),t||this.render())}addMarkers(e,t){e.forEach(e=>{this.addMarker(e,!0)}),t||this.render()}removeMarker(e,t){const r=this.markers.indexOf(e);return-1!==r&&(re.setMap(e,null),this.markers.splice(r,1),t||this.render(),!0)}removeMarkers(e,t){let r=!1;return e.forEach(e=>{r=this.removeMarker(e,!0)||r}),r&&!t&&this.render(),r}clearMarkers(e){this.markers.length=0,e||this.render()}render(){const e=this.getMap();if(e instanceof google.maps.Map&&e.getProjection()){google.maps.event.trigger(this,he.CLUSTERING_BEGIN,this);const{clusters:t,changed:r}=this.algorithm.calculate({markers:this.markers,map:e,mapCanvasProjection:this.getProjection()});if(r||null==r){const e=new Set;for(const r of t)1==r.markers.length&&e.add(r.markers[0]);const r=[];for(const t of this.clusters)null!=t.marker&&(1==t.markers.length?e.has(t.marker)||re.setMap(t.marker,null):r.push(t.marker));this.clusters=t,this.renderClusters(),requestAnimationFrame(()=>r.forEach(e=>re.setMap(e,null)))}google.maps.event.trigger(this,he.CLUSTERING_END,this)}}onAdd(){const e=this.getMap();ie(e),this.idleListener=e.addListener("idle",this.render.bind(this)),this.render()}onRemove(){this.idleListener&&google.maps.event.removeListener(this.idleListener),this.reset()}reset(){this.markers.forEach(e=>re.setMap(e,null)),this.clusters.forEach(e=>e.delete()),this.clusters=[]}renderClusters(){const e=new le(this.markers,this.clusters),t=this.getMap();this.clusters.forEach(r=>{if(1===r.markers.length)r.marker=r.markers[0];else if(r.marker=this.renderer.render(r,e,t),r.markers.forEach(e=>re.setMap(e,null)),this.onClusterClick){const e=re.isAdvancedMarker(r.marker)?he.GMP_CLICK:he.CLUSTER_CLICK;r.marker.addListener(e,e=>{google.maps.event.trigger(this,he.CLUSTER_CLICK,r),this.onClusterClick(e,r,t)})}re.setMap(r.marker,t)})}}var ge=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})},me=function(e,t){var r,n,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},fe=function(){function e(e,t){if(this.version="MapManager.0.0.5",this.markerClusterer=null,this.clusterable=!1,this.marks=new Map,this.polygons=new Map,this.map=null,!t.apiKey)throw new Error("API Key is required");this.initPromise=this.init(e,t)}return e.prototype.init=function(t,r){return ge(this,void 0,void 0,function(){var n,i,s;return me(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),this.clusterable=r.clusterable||!1,[4,new c({apiKey:r.apiKey,version:"weekly",libraries:["places","geometry"]}).load()];case 1:return o.sent(),[4,google.maps.importLibrary("marker")];case 2:if(o.sent(),!(n="string"==typeof t?document.getElementById(t):t))throw new Error("Map container not found");return this.map=new google.maps.Map(n,{center:r.center||e.DEFAULT_CENTER,zoom:r.zoom||e.DEFAULT_ZOOM,mapId:r.idMaps?r.idMaps:"map"}),this.clusterable&&(i=this.map,this.markerClusterer=new de({map:i,algorithm:new ae({radius:100,maxZoom:15})})),console.log(this.version),[3,4];case 3:throw s=o.sent(),console.error("Error initializing map:",s),s;case 4:return[2]}})})},e.prototype.isReady=function(){return ge(this,void 0,void 0,function(){return me(this,function(e){return[2,this.initPromise]})})},e.prototype.getMarkerManaged=function(e){return this.marks.get(e)},e.prototype.addMarkerManaged=function(e){return ge(this,void 0,void 0,function(){var t,r;return me(this,function(n){switch(n.label){case 0:return[4,this.isReady()];case 1:return n.sent(),t=new google.maps.marker.AdvancedMarkerElement({map:this.map,position:e.position,content:this.createCustomIcon(e.icon||"default-icon.png"),title:"Arrastra para mover",gmpDraggable:e.draggable||!1,gmpClickable:e.callable||!1}),r={Id:e.id,marker:t,address:e.address,geocodable:e.geocodable||!1,draggendCallback:e.draggendCallback||void 0,clickMarkerCallback:e.clickMarkerCallback||void 0},this.marks.set(e.id,r),r.draggendCallback&&this.addDragListener(r.Id,r.draggendCallback),r.clickMarkerCallback&&this.addMarkerClickListener(r.Id,r.clickMarkerCallback),this.clusterable&&this.markerClusterer&&this.markerClusterer.addMarker(t),[2]}})})},e.prototype.updateMarkerManaged=function(e){var t;return ge(this,void 0,void 0,function(){var r,n,i,s,o,a,l;return me(this,function(c){switch(c.label){case 0:return[4,this.isReady()];case 1:return c.sent(),(r=this.marks.get(e.id))?(n=r.address!==e.address,i=n&&e.geocodable,n&&(r.address=e.address),i&&r.marker&&r.marker.position?[4,(new google.maps.Geocoder).geocode({address:r.address})]:[3,3]):[3,4];case 2:(s=c.sent()).results.length>0&&(o=s.results[0].geometry.location,a={lat:o.lat(),lng:o.lng()},r.marker.position=a),c.label=3;case 3:!n&&r.marker&&r.marker.position&&(((l=r.marker.position)&&(l.lat!==e.position.lat||l.lng!==e.position.lng)||!l&&e.position)&&r&&r.marker&&(r.marker.position=e.position)),e.toCenter&&this.map&&r.marker&&r.marker.position&&(null===(t=this.map)||void 0===t||t.setCenter(r.marker.position)),c.label=4;case 4:return[2]}})})},e.prototype.removeMarkerManaged=function(e){var t=this.marks.get(e);t&&t.marker&&(this.removeDragListener(e,function(){}),t.marker.map=null,this.marks.delete(e))},e.prototype.addDragListener=function(e,t){var r=this.marks.get(e);console.log("---\x3e ".concat(e)),r&&r.marker&&(r.draggendCallback=t,r.marker.addListener("dragend",function(){var e,t=null===(e=r.marker)||void 0===e?void 0:e.position;if(r.draggendCallback&&t){var n="function"==typeof t.lat?t.lat():t.lat,i="function"==typeof t.lng?t.lng():t.lng;r.draggendCallback({id:r.Id,lat:n,lng:i})}}))},e.prototype.removeDragListener=function(e,t){var r,n=this.marks.get(e);n&&(null===(r=null==n?void 0:n.marker)||void 0===r||r.removeEventListener("dragend",function(){}),n.draggendCallback=void 0)},e.prototype.addMarkerClickListener=function(e,t){var r=this.marks.get(e);r&&r.marker&&(r.clickMarkerCallback=t,r.marker.addListener("click",function(){r.clickMarkerCallback&&r.clickMarkerCallback({id:r.Id})}))},e.prototype.removeMarkerClickListener=function(e,t){var r,n=this.marks.get(e);n&&(null===(r=null==n?void 0:n.marker)||void 0===r||r.removeEventListener("click",function(){}),n.clickMarkerCallback=void 0)},e.prototype.addPolygonManaged=function(e){var t,r,n,i,s;return ge(this,void 0,void 0,function(){var o,a,l;return me(this,function(c){switch(c.label){case 0:return[4,this.isReady()];case 1:return c.sent(),this.map?(o={paths:e.paths,strokeColor:e.strokeColor||"#FF0000",strokeOpacity:parseFloat(e.strokeOpacity)||.8,strokeWeight:parseInt(e.strokeWeight)||2,fillColor:e.fillColor||"#FF0000",fillOpacity:parseFloat(e.fillOpacity)||.35,map:this.map,editable:!1,draggable:!1},(a=new google.maps.Polygon(o)).setVisible(e.visible||!1),l={id:e.id,polygon:a},this.polygons.set(e.id,l),e&&(console.log("Adding center marker for polygon:",e.id),console.log("Center position:",null===(t=e.centro)||void 0===t?void 0:t.position),console.log("Center icon:",null===(r=e.centro)||void 0===r?void 0:r.icon),new google.maps.marker.AdvancedMarkerElement({map:this.map,position:null===(n=e.centro)||void 0===n?void 0:n.position,content:this.createCustomIcon((null===(i=e.centro)||void 0===i?void 0:i.icon)||"default-icon.png"),title:null===(s=e.centro)||void 0===s?void 0:s.label,gmpDraggable:!1,gmpClickable:!1})),[2]):(console.error("Map not initialized"),[2])}})})},e.prototype.createCustomIcon=function(e){var t=document.createElement("img");return t.src=e,t},e.prototype.updatePolygonManaged=function(e){var t=this.polygons.get(e.id);t&&t.polygon.setVisible(e.visible||!1)},e.prototype.getPolygonManaged=function(e){return this.polygons.get(e)},e.DEFAULT_CENTER={lat:-34.6037,lng:-58.3816},e.DEFAULT_ZOOM=13,e}(),ve=function(){function e(e,t){this.version="MapsService.0.0.4",this.mapManager=null,this.mapManager=new fe(e,t)}return e.prototype.setZoom=function(e){var t;(null===(t=this.mapManager)||void 0===t?void 0:t.map)&&this.mapManager.map.setZoom(e)},e.prototype.isReady=function(){return ge(this,void 0,void 0,function(){return me(this,function(e){if(!this.mapManager)throw new Error("MapManager not initialized");return[2]})})},e.prototype.addMarker=function(e){var t,r;return ge(this,void 0,void 0,function(){return me(this,function(n){switch(n.label){case 0:return this.mapManager?[4,this.mapManager.isReady()]:[2];case 1:return n.sent(),(null===(t=this.mapManager)||void 0===t?void 0:t.map)?(null===(r=this.mapManager)||void 0===r?void 0:r.getMarkerManaged(e.id))?[3,3]:(console.log("Adding new marker with id:",e.id),[4,this.mapManager.addMarkerManaged(e)]):[2];case 2:return n.sent(),[3,5];case 3:return console.log("updating marker with id:",e.id),[4,this.mapManager.updateMarkerManaged(e)];case 4:n.sent(),n.label=5;case 5:return[2]}})})},e.prototype.showInfoWindow=function(e){var t,r,n;return ge(this,void 0,void 0,function(){var i;return me(this,function(s){switch(s.label){case 0:return this.mapManager?[4,this.mapManager.isReady()]:[2];case 1:return s.sent(),(null===(t=this.mapManager)||void 0===t?void 0:t.map)?((i=this.mapManager.getMarkerManaged(e.id))&&(null===(r=this.mapManager)||void 0===r?void 0:r.map)&&new google.maps.InfoWindow({content:e.content}).open(null===(n=this.mapManager)||void 0===n?void 0:n.map,i.marker),[2]):[2]}})})},e.prototype.verMarkers=function(e){var t,r,n,i;return ge(this,void 0,void 0,function(){var s,o,a,l;return me(this,function(c){switch(c.label){case 0:return this.mapManager?[4,this.mapManager.isReady()]:[2];case 1:return c.sent(),(null===(t=this.mapManager)||void 0===t?void 0:t.map)?(s=null===(r=this.mapManager)||void 0===r?void 0:r.getMarkerManaged(e))&&(o=null===(n=s.marker)||void 0===n?void 0:n.position)?(a="function"==typeof o.lat?o.lat():o.lat,l="function"==typeof o.lng?o.lng():o.lng,[2,{id:null!==(i=null==s?void 0:s.Id)&&void 0!==i?i:"",position:{lat:a,lng:l},address:null==s?void 0:s.address}]):[2,void 0]:[2]}})})},e.prototype.centerMap=function(e){var t;return ge(this,void 0,void 0,function(){return me(this,function(r){switch(r.label){case 0:return this.mapManager?[4,this.mapManager.isReady()]:[2];case 1:return r.sent(),(null===(t=this.mapManager)||void 0===t?void 0:t.map)?(this.mapManager.map.setCenter(e),[2]):[2]}})})},e.prototype.addPolygon=function(e){var t,r;return ge(this,void 0,void 0,function(){var n;return me(this,function(i){switch(i.label){case 0:return this.mapManager?[4,this.mapManager.isReady()]:[2];case 1:return i.sent(),(null===(t=this.mapManager)||void 0===t?void 0:t.map)?(n=null===(r=this.mapManager)||void 0===r?void 0:r.getPolygonManaged(e.id))?[3,3]:(console.log("Adding new marker with id:",e.id),[4,this.mapManager.addPolygonManaged(e)]):[2];case 2:return i.sent(),[3,5];case 3:return console.log("updating marker with id:",n.id),[4,this.mapManager.updatePolygonManaged(e)];case 4:i.sent(),i.label=5;case 5:return[2]}})})},e}();window.MapsService=ve;const ye=ve;return n.default})());
//# sourceMappingURL=googlemaps.min.js.map